<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å—ç”Ÿæ´»è³‡è¨Šæ¿</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 100%;
            max-width: 380px;
            text-align: center;
        }
        h1 { margin: 0 0 10px 0; font-size: 20px; font-weight: 600; letter-spacing: 1px;}
        
        /* æ™‚é–“å€å¡Š */
        .time-box {
            font-size: 42px;
            font-weight: 700;
            margin: 5px 0 10px 0;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
            line-height: 1;
            font-feature-settings: "tnum";
        }
        .date-box { font-size: 15px; opacity: 0.9; margin-bottom: 20px; }

        /* å³æ™‚è³‡è¨Šå¡ç‰‡ */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        .info-card {
            background: rgba(0, 0, 0, 0.25);
            padding: 12px;
            border-radius: 18px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .label { font-size: 12px; opacity: 0.8; margin-bottom: 3px; }
        .value { font-size: 22px; font-weight: bold; }
        .unit { font-size: 12px; opacity: 0.8; }
        
        .aqi-good { color: #4ade80; } 
        .aqi-moderate { color: #facc15; } 
        .aqi-bad { color: #f87171; } 

        /* æ–°å¢ï¼šæ©«å‘æ»‘å‹•å¤©æ°£é å ± */
        .hourly-title {
            text-align: left;
            font-size: 13px;
            margin-bottom: 8px;
            opacity: 0.8;
            padding-left: 5px;
        }
        .hourly-scroll {
            display: flex;
            overflow-x: auto;
            gap: 10px;
            padding-bottom: 10px;
            margin-bottom: 15px;
            /* éš±è—æ»¾å‹•æ¢ä½†ä¿æŒåŠŸèƒ½ */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE/Edge */
        }
        .hourly-scroll::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }
        .hour-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            min-width: 60px; /* å›ºå®šå¯¬åº¦ */
            padding: 10px 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .hour-time { font-size: 12px; opacity: 0.8; margin-bottom: 5px; }
        .hour-icon { font-size: 20px; margin-bottom: 5px; }
        .hour-temp { font-size: 16px; font-weight: bold; }

        /* è·¯æ³æŒ‰éˆ• */
        .traffic-section {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 18px;
            padding: 12px;
            margin-top: 5px;
        }
        .traffic-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #4285F4;
            color: white;
            text-decoration: none;
            padding: 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .traffic-icon { margin-right: 8px; font-size: 18px; }

        .footer { margin-top: 20px; font-size: 10px; opacity: 0.5; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ“ å°å— Tainan</h1>
        
        <div class="date-box" id="date">è¼‰å…¥ä¸­...</div>
        <div class="time-box" id="time">--:--:--</div>

        <div class="info-grid">
            <div class="info-card">
                <span class="label">ğŸŒ¡ï¸ ç¾åœ¨æ°£æº«</span>
                <div>
                    <span class="value" id="temp">--</span>
                    <span class="unit">Â°C</span>
                </div>
            </div>
            <div class="info-card">
                <span class="label">ğŸƒ ç©ºæ°£å“è³ª</span>
                <div>
                    <span class="value" id="aqi">--</span>
                    <span class="unit" id="aqi-text"></span>
                </div>
            </div>
        </div>

        <div class="hourly-title">ğŸ•“ æœªä¾† 24 å°æ™‚é å ± (å¯æ»‘å‹•)</div>
        <div class="hourly-scroll" id="hourly-container">
            <div class="hour-card">
                <span class="hour-time">--:--</span>
                <span class="hour-icon">âŒ›</span>
                <span class="hour-temp">--Â°</span>
            </div>
        </div>

        <div class="traffic-section">
            <a href="https://www.google.com/maps/dir/å°å—å¸‚æ±å€/å—éƒ¨ç§‘å­¸åœ’å€" 
               target="_blank" 
               class="traffic-btn">
               <span class="traffic-icon">ğŸš—</span> æ±å€ â” å—ç§‘ è·¯æ³
            </a>
        </div>

        <div class="footer">è³‡æ–™ä¾†æº: Open-Meteo</div>
    </div>

    <script>
        // 1. æ›´æ–°æ™‚é–“
        function updateTime() {
            const now = new Date();
            document.getElementById('time').innerText = now.toLocaleTimeString('zh-TW', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('date').innerText = now.toLocaleDateString('zh-TW', options);
        }

        // å¤©æ°£ä»£ç¢¼è½‰ Emoji è¼”åŠ©å‡½å¼
        function getWeatherIcon(code) {
            if (code === 0) return "â˜€ï¸"; // æ™´
            if (code >= 1 && code <= 3) return "â›…"; // å¤šé›²
            if (code >= 45 && code <= 48) return "ğŸŒ«ï¸"; // éœ§
            if (code >= 51 && code <= 67) return "ğŸŒ§ï¸"; // é›¨
            if (code >= 80 && code <= 99) return "â›ˆï¸"; // é›·é›¨
            return "â˜ï¸";
        }

        // 2. æŠ“å–è³‡æ–™
        async function fetchData() {
            try {
                // æŠ“å–ï¼šç•¶å‰å¤©æ°£ + æœªä¾†2å¤©æ¯å°æ™‚é å ± (ç¢ºä¿è·¨å¤œä¹Ÿæœ‰è³‡æ–™)
                const weatherRes = await fetch('https://api.open-meteo.com/v1/forecast?latitude=22.9908&longitude=120.2133&current=temperature_2m&hourly=temperature_2m,weathercode&forecast_days=2&timezone=auto');
                const weatherData = await weatherRes.json();
                
                // è¨­å®šç•¶å‰æ°£æº«
                document.getElementById('temp').innerText = Math.round(weatherData.current.temperature_2m);

                // --- è™•ç†æ¯å°æ™‚é å ± ---
                const hourlyContainer = document.getElementById('hourly-container');
                hourlyContainer.innerHTML = ""; // æ¸…ç©ºè¼‰å…¥ä¸­ç‹€æ…‹

                const currentHourIndex = new Date().getHours(); // å–å¾—ç¾åœ¨å¹¾é» (0-23)
                // å¾ API é™£åˆ—ä¸­ï¼Œå¾ã€Œç¾åœ¨ã€é€™å€‹å°æ™‚é–‹å§‹ï¼Œå¾€å¾ŒæŠ“ 24 ç­†è³‡æ–™
                for (let i = currentHourIndex; i < currentHourIndex + 24; i++) {
                    const timeStr = weatherData.hourly.time[i]; // æ ¼å¼: "2024-01-01T14:00"
                    const temp = Math.round(weatherData.hourly.temperature_2m[i]);
                    const code = weatherData.hourly.weathercode[i];
                    
                    // å¾æ™‚é–“å­—ä¸²å–å‡º "14:00"
                    const hourDisplay = timeStr.split('T')[1];

                    // å»ºç«‹å¡ç‰‡ HTML
                    const card = document.createElement('div');
                    card.className = 'hour-card';
                    card.innerHTML = `
                        <span class="hour-time">${hourDisplay}</span>
                        <span class="hour-icon">${getWeatherIcon(code)}</span>
                        <span class="hour-temp">${temp}Â°</span>
                    `;
                    hourlyContainer.appendChild(card);
                }

                // æŠ“å– AQI
                const airRes = await fetch('https://air-quality-api.open-meteo.com/v1/air-quality?latitude=22.9908&longitude=120.2133&current=us_aqi&timezone=auto');
                const airData = await airRes.json();
                const aqi = airData.current.us_aqi;
                
                const aqiElem = document.getElementById('aqi');
                const aqiTextElem = document.getElementById('aqi-text');
                
                aqiElem.innerText = aqi;
                aqiElem.className = 'value'; 
                
                if (aqi <= 50) {
                    aqiElem.classList.add('aqi-good');
                    aqiTextElem.innerText = "å„ª";
                } else if (aqi <= 100) {
                    aqiElem.classList.add('aqi-moderate');
                    aqiTextElem.innerText = "æ™®";
                } else {
                    aqiElem.classList.add('aqi-bad');
                    aqiTextElem.innerText = "å·®";
                }

            } catch (error) {
                console.error("è³‡æ–™éŒ¯èª¤", error);
            }
        }

        setInterval(updateTime, 1000);
        updateTime();
        fetchData();
    </script>
</body>
</html>
